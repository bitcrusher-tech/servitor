name: Automated Reporting

on:
  workflow_run:
    workflows: ["Adaptive Vulnerability Scanning"]
    types: [completed]

jobs:
  report:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Download Recon + Vuln Results
        uses: actions/download-artifact@v4
        with:
          name: vuln-results

      - name: Generate Consolidated Markdown Report
        run: |
          echo "# Pentest Report - $(date)" > REPORT.md
          echo "## High Severity Vulnerabilities" >> REPORT.md
          cat nuclei_high.txt >> REPORT.md
          echo "## Fuzzing Insights" >> REPORT.md
          cat fuzz_results.json >> REPORT.md

      - name: Upload Final Report
        uses: actions/upload-artifact@v4
        with:
          name: pentest-report
          path: REPORT.md
